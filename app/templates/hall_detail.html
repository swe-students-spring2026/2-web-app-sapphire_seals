{% extends "base.html" %}
{% set show_header = False %}

{% block content %}
<div class="hall-detail">

    <!-- Top bar -->
    <header class="hd-topbar">
        <a class="hd-back" href="/halls" aria-label="Back">‚Äπ</a>
        <h1 class="hd-title">{{ hall.name }}</h1>
        <div class="hd-actions" aria-label="Actions">
            <a href="/search" class="hd-action" style="text-decoration:none;">üîç</a>
            <span class="hd-action" title="settings">üéõÔ∏è</span>
        </div>
    </header>

    <!-- Hall header card -->
    <section class="hd-card">
        <div class="hd-avatar" aria-hidden="true"></div>
        <div class="hd-card-text">
            <div class="hd-hall-name">{{ hall.name }}</div>
            <div class="hd-subtitle">
                {% if hall.get('greenRestaurant') %}üåø Green Restaurant{% endif %}
                {% if hall.get('mobileOrderingLabel') %} ‚Ä¢ {{ hall.mobileOrderingLabel }}{% endif %}
                {% if not hall.get('greenRestaurant') and not hall.get('mobileOrderingLabel') %}NYU Dining{% endif %}
            </div>
        </div>
    </section>

    <!-- Today's Meals grid -->
    <section class="hd-section">
        <h2 class="hd-section-title">Menu Items ({{ meals | length }})</h2>

        {% if meals and meals | length > 0 %}
        <div class="hd-grid">
            {% for m in meals %}
            <a href="/meal/{{ m.id }}" class="meal-card" style="text-decoration:none; color:inherit;">
                <div class="meal-category">{{ m.category }}</div>
                <div class="meal-photo" aria-hidden="true">{{ m.calories }} cal</div>
                <div class="meal-desc">{{ m.name }}</div>
                <div class="meal-name">{{ m.desc }}</div>

                {% if m.averageScore and m.averageScore > 0 %}
                <div class="review-stars" style="margin-top:4px;">
                    {% for i in range(1, 6) %}
                    {% if i <= m.averageScore | round(0, 'floor' ) | int %} <span class="star is-on">‚òÖ</span>
                        {% else %}
                        <span class="star">‚òÖ</span>
                        {% endif %}
                        {% endfor %}
                </div>
                {% endif %}
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p class="dh-empty">No menu items found for this dining hall.</p>
        {% endif %}
    </section>

    <!-- Reviews list -->
    <section class="hd-section">
        <h2 class="hd-section-title">Reviews</h2>

        {% if reviews and reviews | length > 0 %}
        <div class="review-list">
            {% for r in reviews[:15] %}
            <div class="review-row">
                <div class="review-avatar" aria-hidden="true"></div>
                <div class="review-body">
                    <div class="review-name">{{ r.food_name }}</div>
                    <div class="review-text">{{ r.text[:150] }}{% if r.text | length > 150 %}...{% endif %}</div>
                </div>
                <div class="review-stars" aria-label="Rating {{ r.rating }} out of 5">
                    {% for i in range(1, 6) %}
                    {% if i <= r.rating %} <span class="star is-on">‚òÖ</span>
                        {% else %}
                        <span class="star">‚òÖ</span>
                        {% endif %}
                        {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="dh-empty">No reviews yet. Be the first to rate a meal!</p>
        {% endif %}
    </section>

    <!-- Diet preference chips -->

    {% if filters | length > 0 %}
    <section class="hd-section">
        <h2 class="hd-section-title">Dietary Options</h2>
        <div class="chip-grid">
            {% for f in filters[:8] %}
            <div class="chip">
                <span class="chip-ic">üçΩ</span>
                <span>{{ f.name }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Sticky CTA -->
    <div class="hd-cta-wrap">
        <a class="hd-cta" href="/search">üîç Search All Meals</a>
    </div>

</div>
{% endblock %}